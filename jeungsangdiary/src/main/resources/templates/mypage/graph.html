<!DOCTYPE html>
<html lang="en" xmlns="www.thymeleaf.org">
    <head th:replace="fragments/common :: scripts">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>내 건강 요약</title>
</head>
<body>  
    <div th:replace="fragments/common :: header"></div>
    <section class="main container">
    <div style="width: 80%; margin: 0 auto;">
        <!-- 제목 영역 -->
        <div class="d-flex justify-content-between align-items-center">
            <h1>내 건강 요약</h1>
        </div>          
        <canvas id="barChart"></canvas>
    </div>
	<script>
		
		var no = 1000;
		var obj = {"num" : no};
		
		var monthList = [];
		var monthMem = [];
		
		$(document).ready(function(){
			alert('d');
			getChartData();
			
		});
		
		function getChartData() {
			
		    //3단계 데이터 만들기
		    //var monthList = [202302, 202303, 202304, 202305];
		    //var monthMem = [50, 55, 60, 70, 85];
		    
	        // contentType: 'application/json',
	    	// data: JSON.stringify(obj2),	   
		    // GET 주로 데이터를 가져옴
		    
		    // 적용하려면
		    // chart.html -> 막대그래프 만든 화면과 동일
		    // MyDataController -> 김도연씨 컨트롤
		    
		    $.ajax({
		    	type: 'GET',
		    	url: 'restgraph',
		    	dataType: 'json',
		    	data: obj,	        
	            success: function(data) {
	                alert("성공");   
	                alert(data);
	                
	                for(i=0; i<data.length; i++) {
	                	monthList.push(data[i].dttm);
	                	monthMem.push(data[i].num);
	                }
	                
	             	// 4단계 - canvas tag 사용함
                    // 막대 그래프 생성
                    var ctx = document.getElementById('barChart').getContext('2d');
                    var barChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
							labels: monthList,
							datasets: [{
									data: monthMem,
									label: 'Number of People',
									borderColor: 'rgba(255,0,0,1)',
									borderWidth: 2
							}]
						},
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            }
                        }
                    });
		
		                        
			        // 5단계
			        // canvas 컨텍스, json 형식 데이터(키: 값)
					//myChart1 = new Chart(ctx, barChart);
			        
	            },
	            error:function(request,status,error){
	                alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	            }
		
		    }); 
		}
		
	</script>
</body>
</html>
